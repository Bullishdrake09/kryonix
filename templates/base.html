<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{% block title %}My App{% endblock %}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js    "></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Dynamic styles for theme colors */
        :root {
            --primary-color: {{ session.get('primary_color', '#0f0f0f') }};
            --accent-color: {{ session.get('accent_color', '#ff3f81') }};
        }

        /* --- Page Transition Overlay Styles --- */
        #page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0a2e, #1a0a3c, #2d0a5a, #1a0a3c);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            visibility: visible;
            transition: opacity 1.5s cubic-bezier(0.23, 1, 0.32, 1), visibility 1.5s ease 1.9s;
        }

        #page-transition-overlay.inactive {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #page-transition-overlay .logo {
            color: white;
            font-size: 4rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 6px;
            opacity: 0;
            transform: scale(0.5) rotateX(90deg);
            transition: all 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            text-shadow: 0 0 15px rgba(128, 0, 255, 0.7);
        }

        #page-transition-overlay .logo::before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            color: transparent;
            background: linear-gradient(90deg, #8a2be2, #4b0082, #0000ff, #1e90ff);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% 300%;
            animation: shine 3s infinite;
            z-index: -1;
            filter: blur(1px);
            opacity: 0.7;
        }

        /* Active state for the logo text animation */
        #page-transition-overlay:not(.inactive) .logo {
            opacity: 1;
            transform: scale(1) rotateX(0);
            transition: all 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s;
        }

        /* Enhanced background animation */
        #page-transition-overlay {
            background: radial-gradient(circle at center, #1a0a3c 0%, #0f0a2e 40%, #0d0d1a 100%);
            background-size: 400% 400%;
            animation: gradientBGOverlay 8s ease infinite, pulseGlow 4s ease-in-out infinite;
        }

        @keyframes gradientBGOverlay {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        @keyframes pulseGlow {
            0% { box-shadow: inset 0 0 50px rgba(75, 0, 130, 0.5); }
            50% { box-shadow: inset 0 0 100px rgba(128, 0, 255, 0.7); }
            100% { box-shadow: inset 0 0 50px rgba(75, 0, 130, 0.5); }
        }

        @keyframes shine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- End Page Transition Overlay Styles --- */

    </style>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <!-- Add the overlay div here -->
    <div id="page-transition-overlay">
        <div class="logo" data-text="KRYONIX">KRYONIX</div>
    </div>

    {% block content %}{% endblock %}

    <script>
    // --- Page Transition Script ---
    document.addEventListener('DOMContentLoaded', function() {
        const pageTransitionOverlay = document.getElementById('page-transition-overlay');

        // Handle link clicks
        document.body.addEventListener('click', function(event) {
            const link = event.target.closest('a');
            if (link && link.href && !link.target && !link.hasAttribute('download')) {
                event.preventDefault();

                // Ensure the overlay is visible and reset its state
                pageTransitionOverlay.classList.remove('inactive');
                
                // Navigate after animation completes
                setTimeout(function() {
                    window.location.href = link.href;
                }, 2700); // Increased timeout for longer animation
            }
        });

        // Fade out overlay on new page load
        requestAnimationFrame(() => {
             setTimeout(() => {
                 pageTransitionOverlay.classList.add('inactive');
             }, 10);
        });

    });
    // --- End Page Transition Script ---
    </script>
</body>
</html>
