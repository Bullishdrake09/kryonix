<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{% block title %}My App{% endblock %}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js  "></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Dynamic styles for theme colors */
        :root {
            --primary-color: {{ session.get('primary_color', '#0f0f0f') }};
            --accent-color: {{ session.get('accent_color', '#ff3f81') }};
        }

        /* --- Page Transition Overlay Styles --- */
        #page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Changed to dark blue gradient */
            background: linear-gradient(135deg, #0d0d1a, #0f0c29, #24243e, #0d0d1a);
            z-index: 9999; /* Very high z-index to cover everything */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1; /* Starts fully opaque */
            visibility: visible; /* Starts visible */
            /* Transition for fade out - Increased duration */
            transition: opacity 1.0s ease 0.4s, visibility 1.0s ease 1.4s; /* Fade-out takes 1.0s after 0.4s delay, visibility delayed further */
        }

        #page-transition-overlay.inactive {
            opacity: 0;
            visibility: hidden;
            pointer-events: none; /* Add this line */
        }

        #page-transition-overlay .logo {
            color: white; /* White text */
            font-size: 3rem; /* Adjust size as needed */
            font-weight: bold;
            text-transform: uppercase; /* Makes "KRYONIX" uppercase */
            letter-spacing: 4px; /* Adds space between letters */
            /* Initial state for text animation */
            opacity: 0;
            transform: scale(0.8);
            /* Transition for text animation - Increased duration */
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        /* Active state for the logo text animation (happens immediately when overlay is shown) */
        #page-transition-overlay:not(.inactive) .logo {
            opacity: 1;
            transform: scale(1);
            /* Add a slight delay to the text animation to make it feel less abrupt - Increased delay */
            transition: opacity 0.5s ease 0.2s, transform 0.5s ease 0.2s; /* Text animation delay increased */
        }

        /* Optional: Add a subtle animation to the background gradient itself */
        #page-transition-overlay {
            background-size: 400% 400%;
            animation: gradientBGOverlay 15s ease infinite;
        }

        @keyframes gradientBGOverlay {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        /* --- End Page Transition Overlay Styles --- */

    </style>
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <!-- Add the overlay div here -->
    <div id="page-transition-overlay">
        <div class="logo">KRYONIX</div>
    </div>

    {% block content %}{% endblock %}

    <script>
    // --- Page Transition Script ---
    document.addEventListener('DOMContentLoaded', function() {
        const pageTransitionOverlay = document.getElementById('page-transition-overlay');

        // Handle link clicks
        document.body.addEventListener('click', function(event) {
            // Find the closest link element
            const link = event.target.closest('a');
            if (link && link.href && !link.target && !link.hasAttribute('download')) {
                event.preventDefault(); // Stop the default navigation

                // Ensure the overlay is visible and reset its state for fade-in
                pageTransitionOverlay.classList.remove('inactive');
                // Reset logo animation state (optional, as CSS handles it on visibility)
                // pageTransitionOverlay.classList.add('active'); // Not needed if :not(.inactive) handles logo

                // Wait for the fade-in and logo animation to complete
                // Total time: logo delay (0.2s) + logo animation (0.5s) + overlay delay (0.4s) + overlay fade-out (1.0s) = 2.1s
                // Let's use a slightly longer timeout to be safe.
                setTimeout(function() {
                    window.location.href = link.href; // Navigate to the new page
                }, 2200); // Increased timeout to match longer animation
            }
        });

        // On the *new* page load, the overlay will initially be active (visible, opaque).
        // We need to fade it out *after* the page content has loaded and is visible.
        // Using requestAnimationFrame and a short delay helps ensure the page paints first.
        requestAnimationFrame(() => {
             setTimeout(() => {
                 // Add the 'inactive' class to trigger the fade-out transition
                 pageTransitionOverlay.classList.add('inactive');
                 // Optional: Remove the overlay entirely after fade-out if desired
                 // setTimeout(() => pageTransitionOverlay.remove(), 1400); // Match CSS transition + delay time (1.0s + 0.4s)
             }, 10); // Small delay after rAF to allow rendering
        });

    });
    // --- End Page Transition Script ---
    </script>
</body>
</html>